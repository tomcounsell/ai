[pytest]
# Pytest configuration for AI System with real integration testing

# Test discovery patterns
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Directory configuration
testpaths = tests
norecursedirs = .git .venv venv __pycache__ *.egg-info build dist docs

# Output configuration
addopts = 
    # Verbose output with color
    -v
    --color=yes
    
    # Show test durations
    --durations=10
    
    # Capture logs
    --log-cli-level=INFO
    --log-file=logs/pytest.log
    --log-file-level=DEBUG
    
    # Coverage settings (when using --cov)
    --cov-report=term-missing
    --cov-report=html:htmlcov
    --cov-report=json:coverage.json
    --cov-branch
    
    # Strict markers
    --strict-markers
    
    # Show warnings
    -W ignore::DeprecationWarning
    
    # Parallel execution (when using -n)
    --maxfail=5

# Test markers for organization
markers =
    unit: Unit tests that test individual components
    integration: Integration tests with real services (no mocks)
    performance: Performance and load testing
    e2e: End-to-end workflow tests
    slow: Tests that take more than 5 seconds
    critical: Critical path tests that must pass
    security: Security-related tests
    database: Database operation tests
    api: API endpoint tests
    agent: Agent functionality tests
    tool: Tool integration tests
    mcp: MCP server tests
    telegram: Telegram integration tests
    real_api: Tests that use real external APIs (costs money)

# Environment variables for testing
env =
    TESTING = true
    DATABASE_PATH = data/test.db
    LOG_LEVEL = DEBUG

# Timeout configuration
timeout = 300
timeout_method = thread

# Asyncio configuration
asyncio_mode = auto

# Coverage configuration
[coverage:run]
source = .
omit = 
    */tests/*
    */test_*.py
    */__pycache__/*
    */.venv/*
    */venv/*
    setup.py
    */migrations/*

[coverage:report]
precision = 2
skip_covered = False
show_missing = True
exclude_lines =
    pragma: no cover
    def __repr__
    raise AssertionError
    raise NotImplementedError
    if __name__ == .__main__.:
    if TYPE_CHECKING:
    @abstractmethod

[coverage:html]
directory = htmlcov

# Logging configuration
[tool:pytest]
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] [%(name)s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

log_file = logs/pytest.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] [%(name)s] %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# Real Integration Testing Configuration
# NO MOCKS - Always use real services and APIs
[tool:pytest:integration]
use_real_services = true
mock_external_apis = false
integration_timeout = 60

# Test data configuration
[tool:pytest:fixtures]
fixture_path = tests/fixtures
test_data_path = tests/data
temp_path = tests/temp